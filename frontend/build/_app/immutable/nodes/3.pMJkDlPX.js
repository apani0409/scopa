import{c as dt,a as E,f as A}from"../chunks/Bwf9qTKs.js";import"../chunks/BbsrXejN.js";import{c as Dt,o as Ft,a as ys}from"../chunks/DRUbZCeC.js";import{H as se,V as Je,ad as ms,F as Xe,N as ws,M as $s,g as i,Q as Ss,T as xs,U as Tt,W as Ze,I as ze,ab as Ts,aW as ks,aK as kt,A as Cs,G as tt,a$ as Es,K as Is,b0 as Lt,y as Se,am as Ns,aV as ut,b1 as As,aw as Ct,b2 as Os,b3 as Ms,m as P,b4 as oe,B as Ht,E as Wt,b5 as et,ae as Bt,b6 as Rs,b7 as zs,aT as Ds,C as Fs,ac as Ls,o as Hs,O as Ws,b8 as Bs,ar as Us,a6 as Ut,b as R,b9 as Ps,ba as Ys,n as we,aP as Pt,X as Ae,bb as j,s as D,e as De,bc as He,Y as ke,_ as Oe,$ as b,a0 as g,Z as K,a1 as $,aL as Yt,bd as Et,a7 as qs}from"../chunks/DtFH08mZ.js";import{a as js,e as Ee,s as U}from"../chunks/BSBlUjVE.js";import{i as Y}from"../chunks/CSHLn78M.js";import{a as fe,w as de,e as xe,b as Fe,c as ne,d as re,f as ue,g as Ce,l as st,i as at,k as nt,m as Le,n as rt,o as qt,q as Gs,t as Vs,p as it,u as Qs,v as Ks,h as Js,s as Xs,j as It}from"../chunks/DSjyWIzM.js";import{i as We}from"../chunks/C1tfcwLj.js";import{p as ae,s as H,a as jt}from"../chunks/CEAuuTM4.js";import{s as Zs,g as Nt}from"../chunks/C54pvyWc.js";function ot(e,t){return t}function ea(e,t,r){for(var s=[],c=t.length,a,o=t.length,d=0;d<c;d++){let m=t[d];Wt(m,()=>{if(a){if(a.pending.delete(m),a.done.add(m),a.pending.size===0){var p=e.outrogroups;lt(ut(a.done)),p.delete(a),p.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=s.length===0&&r!==null;if(l){var u=r,f=u.parentNode;Ds(f),f.append(u),e.items.clear()}lt(t,!l)}else a={pending:new Set(t),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(a)}function lt(e,t=!0){for(var r=0;r<e.length;r++)Fs(e[r],t)}var At;function Ie(e,t,r,s,c,a=null){var o=e,d=new Map,l=(t&Lt)!==0;if(l){var u=e;o=se?Je(ms(u)):u.appendChild(Xe())}se&&ws();var f=null,m=Se(()=>{var v=r();return Ns(v)?v:v==null?[]:ut(v)}),p,S=!0;function x(){n.fallback=f,ta(n,p,o,t,s),f!==null&&(p.length===0?(f.f&oe)===0?Ht(f):(f.f^=oe,Te(f,null,o)):Wt(f,()=>{f=null}))}var _=$s(()=>{p=i(m);var v=p.length;let z=!1;if(se){var L=Ss(o)===xs;L!==(v===0)&&(o=Tt(),Je(o),Ze(!1),z=!0)}for(var N=new Set,F=Cs,I=Is(),y=0;y<v;y+=1){se&&ze.nodeType===Ts&&ze.data===ks&&(o=ze,z=!0,Ze(!1));var k=p[y],O=s(k,y),C=S?null:d.get(O);C?(C.v&&kt(C.v,k),C.i&&kt(C.i,y),I&&F.unskip_effect(C.e)):(C=sa(d,S?o:At??(At=Xe()),k,O,y,c,t,r),S||(C.e.f|=oe),d.set(O,C)),N.add(O)}if(v===0&&a&&!f&&(S?f=tt(()=>a(o)):(f=tt(()=>a(At??(At=Xe()))),f.f|=oe)),v>N.size&&Es(),se&&v>0&&Je(Tt()),!S)if(I){for(const[W,B]of d)N.has(W)||F.skip_effect(B.e);F.oncommit(x),F.ondiscard(()=>{})}else x();z&&Ze(!0),i(m)}),n={effect:_,items:d,outrogroups:null,fallback:f};S=!1,se&&(o=ze)}function $e(e){for(;e!==null&&(e.f&Rs)===0;)e=e.next;return e}function ta(e,t,r,s,c){var C,W,B,Z,le,ee,q,ce,pe;var a=(s&zs)!==0,o=t.length,d=e.items,l=$e(e.effect.first),u,f=null,m,p=[],S=[],x,_,n,v;if(a)for(v=0;v<o;v+=1)x=t[v],_=c(x,v),n=d.get(_).e,(n.f&oe)===0&&((W=(C=n.nodes)==null?void 0:C.a)==null||W.measure(),(m??(m=new Set)).add(n));for(v=0;v<o;v+=1){if(x=t[v],_=c(x,v),n=d.get(_).e,e.outrogroups!==null)for(const h of e.outrogroups)h.pending.delete(n),h.done.delete(n);if((n.f&oe)!==0)if(n.f^=oe,n===l)Te(n,null,r);else{var z=f?f.next:l;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),ve(e,f,n),ve(e,n,z),Te(n,z,r),f=n,p=[],S=[],l=$e(f.next);continue}if((n.f&et)!==0&&(Ht(n),a&&((Z=(B=n.nodes)==null?void 0:B.a)==null||Z.unfix(),(m??(m=new Set)).delete(n))),n!==l){if(u!==void 0&&u.has(n)){if(p.length<S.length){var L=S[0],N;f=L.prev;var F=p[0],I=p[p.length-1];for(N=0;N<p.length;N+=1)Te(p[N],L,r);for(N=0;N<S.length;N+=1)u.delete(S[N]);ve(e,F.prev,I.next),ve(e,f,F),ve(e,I,L),l=L,f=I,v-=1,p=[],S=[]}else u.delete(n),Te(n,l,r),ve(e,n.prev,n.next),ve(e,n,f===null?e.effect.first:f.next),ve(e,f,n),f=n;continue}for(p=[],S=[];l!==null&&l!==n;)(u??(u=new Set)).add(l),S.push(l),l=$e(l.next);if(l===null)continue}(n.f&oe)===0&&p.push(n),f=n,l=$e(n.next)}if(e.outrogroups!==null){for(const h of e.outrogroups)h.pending.size===0&&(lt(ut(h.done)),(le=e.outrogroups)==null||le.delete(h));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||u!==void 0){var y=[];if(u!==void 0)for(n of u)(n.f&et)===0&&y.push(n);for(;l!==null;)(l.f&et)===0&&l!==e.fallback&&y.push(l),l=$e(l.next);var k=y.length;if(k>0){var O=(s&Lt)!==0&&o===0?r:null;if(a){for(v=0;v<k;v+=1)(q=(ee=y[v].nodes)==null?void 0:ee.a)==null||q.measure();for(v=0;v<k;v+=1)(pe=(ce=y[v].nodes)==null?void 0:ce.a)==null||pe.fix()}ea(e,y,O)}}a&&Bt(()=>{var h,M;if(m!==void 0)for(n of m)(M=(h=n.nodes)==null?void 0:h.a)==null||M.apply()})}function sa(e,t,r,s,c,a,o,d){var l=(o&Os)!==0?(o&Ms)===0?P(r,!1,!1):Ct(r):null,u=(o&As)!==0?Ct(c):null;return{v:l,i:u,e:tt(()=>(a(t,l??r,u??c,d),()=>{e.delete(s)}))}}function Te(e,t,r){if(e.nodes)for(var s=e.nodes.start,c=e.nodes.end,a=t&&(t.f&oe)===0?t.nodes.start:r;s!==null;){var o=Ls(s);if(a.before(s),s===c)return;s=o}}function ve(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}const aa=()=>performance.now(),ie={tick:e=>requestAnimationFrame(e),now:()=>aa(),tasks:new Set};function Gt(){const e=ie.now();ie.tasks.forEach(t=>{t.c(e)||(ie.tasks.delete(t),t.f())}),ie.tasks.size!==0&&ie.tick(Gt)}function na(e){let t;return ie.tasks.size===0&&ie.tick(Gt),{promise:new Promise(r=>{ie.tasks.add(t={c:e,f:r})}),abort(){ie.tasks.delete(t)}}}function ct(e,t){Pt(()=>{e.dispatchEvent(new CustomEvent(t))})}function ra(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function Ot(e){const t={},r=e.split(";");for(const s of r){const[c,a]=s.split(":");if(!c||a===void 0)break;const o=ra(c.trim());t[o]=a.trim()}return t}const ia=e=>e;function oa(e,t,r,s){var n;var c=(e&Ps)!==0,a="in",o,d=t.inert,l=t.style.overflow,u,f;function m(){return Pt(()=>o??(o=r()(t,(s==null?void 0:s())??{},{direction:a})))}var p={is_global:c,in(){t.inert=d,u==null||u.abort(),u=Vt(t,m(),f,1,()=>{ct(t,"introend"),u==null||u.abort(),u=o=void 0,t.style.overflow=l})},out(v){{v==null||v(),o=void 0;return}},stop:()=>{u==null||u.abort()}},S=Hs;if(((n=S.nodes).t??(n.t=[])).push(p),js){var x=c;if(!x){for(var _=S.parent;_&&(_.f&Ws)!==0;)for(;(_=_.parent)&&(_.f&Bs)===0;);x=!_||(_.f&Us)!==0}x&&Ut(()=>{R(()=>p.in())})}}function Vt(e,t,r,s,c){if(Ys(t)){var a,o=!1;return Bt(()=>{if(!o){var _=t({direction:"in"});a=Vt(e,_,r,s,c)}}),{abort:()=>{o=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(!(t!=null&&t.duration)&&!(t!=null&&t.delay))return ct(e,"introstart"),c(),{abort:we,deactivate:we,reset:we,t:()=>s};const{delay:d=0,css:l,tick:u,easing:f=ia}=t;var m=[];if(u&&u(0,1),l){var p=Ot(l(0,1));m.push(p,p)}var S=()=>1-s,x=e.animate(m,{duration:d,fill:"forwards"});return x.onfinish=()=>{x.cancel(),ct(e,"introstart");var _=1-s,n=s-_,v=t.duration*Math.abs(n),z=[];if(v>0){var L=!1;if(l)for(var N=Math.ceil(v/16.666666666666668),F=0;F<=N;F+=1){var I=_+n*f(F/N),y=Ot(l(I,1-I));z.push(y),L||(L=y.overflow==="hidden")}L&&(e.style.overflow="hidden"),S=()=>{var k=x.currentTime;return _+n*f(k/v)},u&&na(()=>{if(x.playState!=="running")return!1;var k=S();return u(k,1-k),!0})}x=e.animate(z,{duration:v,fill:"forwards"}),x.onfinish=()=>{S=()=>s,u==null||u(s,1-s),c()}},{abort:()=>{x&&(x.cancel(),x.effect=null,x.onfinish=we)},deactivate:()=>{c=we},reset:()=>{},t:()=>S()}}const Mt=[...` 	
\r\f¬†\v\uFEFF`];function la(e,t,r){var s=e==null?"":""+e;if(r){for(var c of Object.keys(r))if(r[c])s=s?s+" "+c:c;else if(s.length)for(var a=c.length,o=0;(o=s.indexOf(c,o))>=0;){var d=o+a;(o===0||Mt.includes(s[o-1]))&&(d===s.length||Mt.includes(s[d]))?s=(o===0?"":s.substring(0,o))+s.substring(d+1):o=d}}return s===""?null:s}function ca(e,t){return e==null?null:String(e)}function Ne(e,t,r,s,c,a){var o=e.__className;if(se||o!==r||o===void 0){var d=la(r,s,a);(!se||d!==e.getAttribute("class"))&&(d==null?e.removeAttribute("class"):e.className=d),e.__className=r}else if(a&&c!==a)for(var l in a){var u=!!a[l];(c==null||u!==!!c[l])&&e.classList.toggle(l,u)}return a}function vt(e,t,r,s){var c=e.__style;if(se||c!==t){var a=ca(t);(!se||a!==e.getAttribute("style"))&&(a==null?e.removeAttribute("style"):e.style.cssText=a),e.__style=t}return s}const va=!1,da=!1,ln=Object.freeze(Object.defineProperty({__proto__:null,prerender:va,ssr:da},Symbol.toStringTag,{value:"Module"})),ua=()=>{const e=Zs;return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},updated:e.updated}},fa={subscribe(e){return ua().page.subscribe(e)}};function pa(e){const t=e-1;return t*t*t+1}function Rt(e){const t=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}function _a(e,{delay:t=0,duration:r=400,easing:s=pa,x:c=0,y:a=0,opacity:o=0}={}){const d=getComputedStyle(e),l=+d.opacity,u=d.transform==="none"?"":d.transform,f=l*(1-o),[m,p]=Rt(c),[S,x]=Rt(a);return{delay:t,duration:r,easing:s,css:(_,n)=>`
			transform: ${u} translate(${(1-_)*m}${p}, ${(1-_)*S}${x});
			opacity: ${l-f*n}`}}var ga=A('<div><button><img draggable="false" class="svelte-1udyrqm"/></button></div>'),ba=A('<button><img draggable="false" class="svelte-1udyrqm"/></button>');function zt(e,t){Ae(t,!1);const r=P();let s=ae(t,"card",8),c=ae(t,"selectable",8,!1),a=ae(t,"selected",8,!1),o=ae(t,"capturable",8,!1),d=ae(t,"pending",8,!1),l=ae(t,"animateIn",8,!1);const u=Dt();function f(){(c()||o()||d())&&u("click",s())}j(()=>De(s()),()=>{D(r,`${s().value} di ${s().suit}`)}),He(),We();var m=dt(),p=ke(m);{var S=_=>{var n=ga(),v=b(n);let z;var L=b(v);g(v),g(n),K(()=>{z=Ne(v,1,"card svelte-1udyrqm",null,z,{selectable:c(),selected:a(),capturable:o(),pending:d()}),fe(v,"aria-label",i(r)),v.disabled=!c()&&!o()&&!d(),fe(L,"src",(De(s()),R(()=>s().image_url))),fe(L,"alt",i(r))}),Ee("click",v,f),oa(1,n,()=>_a,()=>({y:24,duration:260,opacity:0})),E(_,n)},x=_=>{var n=ba();let v;var z=b(n);g(n),K(()=>{v=Ne(n,1,"card svelte-1udyrqm",null,v,{selectable:c(),selected:a(),capturable:o(),pending:d()}),fe(n,"aria-label",i(r)),n.disabled=!c()&&!o()&&!d(),fe(z,"src",(De(s()),R(()=>s().image_url))),fe(z,"alt",i(r))}),Ee("click",n,f),E(_,n)};Y(p,_=>{l()?_(S):_(x,!1)})}E(e,m),Oe()}var ha=A('<div class="back svelte-legrwj"></div>'),ya=A('<span class="badge svelte-legrwj"> </span>'),ma=A('<div class="stack svelte-legrwj"><!> <!></div>');function wa(e,t){Ae(t,!1);const r=P();let s=ae(t,"count",8,0);j(()=>De(s()),()=>{D(r,Math.min(s(),4))}),He();var c=ma(),a=b(c);Ie(a,1,()=>(i(r),R(()=>Array(i(r)))),ot,(l,u,f)=>{var m=ha();vt(m,`
                transform:  translate(${f*4}px, ${f*-3}px);
                z-index:    ${f};
                opacity:    ${.65+f*.12};
            `),E(l,m)});var o=$(a,2);{var d=l=>{var u=ya(),f=b(u,!0);g(u),K(()=>U(f,s())),E(l,u)};Y(o,l=>{s()>0&&l(d)})}g(c),K(()=>fe(c,"aria-label",`${s()??""} card${s()!==1?"s":""}`)),E(e,c),Oe()}let Q=null,Qt=null;function $a(e,t){Qt=t,Q&&(Q.close(),Q=null);const s=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws/${e}/${t}`;de.set("connecting"),Q=new WebSocket(s),Q.onopen=()=>{de.set("connected"),console.log("[WS] Connected to",s)},Q.onmessage=({data:c})=>{try{ka(JSON.parse(c))}catch(a){console.error("[WS] Failed to parse message:",c,a)}},Q.onerror=c=>{console.error("[WS] Error:",c),de.set("disconnected")},Q.onclose=()=>{de.set("disconnected"),console.log("[WS] Closed")}}function Sa(){Q&&(Q.close(),Q=null)}function xa(e,t=[]){Kt({type:"play",card_id:e,capture_ids:t})}function Ta(e){Kt({type:"get_captures",card_id:e})}function ka(e){var t,r;switch(e.type){case"waiting":rt.set(!0),de.set("waiting");break;case"game_started":rt.set(!1),de.set("connected"),e.opponent_id&&qt.set(e.opponent_id),e.round&&at.set(e.round),ue.set(null),ne.set([]),re.set(!1),Fe.set(null),Ce.set(null),nt.set("full"),Le.set(!0);break;case"cards_dealt":e.round&&at.set(e.round),ue.set(null),ne.set([]),re.set(!1),nt.set("hands"),Le.set(!0);break;case"state":{let s=null;Ce.subscribe(a=>{s=a})();const c=e.state;if(s)for(const[a,o]of Object.entries(c.players??{})){const d=((r=(t=s.players)==null?void 0:t[a])==null?void 0:r.scopas)??0;o.scopas>d&&(st.set({player_id:a,is_mine:a===Qt}),setTimeout(()=>st.set(null),2500))}Ce.set(c),xe.set(null),Fe.set(null),c.is_human_turn||(ue.set(null),ne.set([]),re.set(!1));break}case"captures":ne.set(e.options),re.set(!0);break;case"round_over":Fe.set(e),ne.set([]),re.set(!1),ue.set(null);break;case"error":xe.set(e.message),setTimeout(()=>xe.set(null),4e3);break;case"opponent_disconnected":de.set("disconnected"),xe.set("Opponent disconnected.");break;case"pong":break;default:console.warn("[WS] Unknown message type:",e.type)}}function Kt(e){Q&&Q.readyState===WebSocket.OPEN?Q.send(JSON.stringify(e)):console.warn("[WS] Cannot send ‚Äî not connected:",e)}var Ca=A('<div class="board-empty svelte-9e286u"></div>'),Ea=A('<span class="badge thinking svelte-9e286u">thinking‚Ä¶</span>'),Ia=A('<span class="empty svelte-9e286u">Table is empty</span>'),Na=A("<div> </div>"),Aa=A('<div class="error-banner svelte-9e286u" role="alert"> </div>'),Oa=A(`<div class="overlay svelte-9e286u" role="dialog" aria-modal="true"><div class="result-card svelte-9e286u"><div class="result-icon svelte-9e286u">üéâ</div> <h2 class="svelte-9e286u"> </h2> <div class="result-rows svelte-9e286u"><div class="result-row svelte-9e286u"><span class="svelte-9e286u">You</span> <span class="gain svelte-9e286u"> </span></div> <div class="result-row svelte-9e286u"><span class="svelte-9e286u">Opponent</span> <span class="gain svelte-9e286u"> </span></div></div> <p class="cumul svelte-9e286u">Total ‚Äî You: <strong class="svelte-9e286u"> </strong> &nbsp;|&nbsp;
                    Opp: <strong class="svelte-9e286u"> </strong></p> <p class="next-hint svelte-9e286u">Next round starting‚Ä¶</p></div></div>`),Ma=A('<span class="badge your-turn svelte-9e286u">Your turn ‚ú®</span>'),Ra=A('<span class="hint-text svelte-9e286u">Tap more cards to complete the combination, or tap a selected card to undo</span>'),za=A('<span class="hint-text svelte-9e286u">Tap a glowing card on the table to capture ‚ú®</span>'),Da=A('<span class="hint-discard svelte-9e286u">No captures ‚Äî tap your card again to discard</span>'),Fa=A('<span class="hint-text svelte-9e286u"> </span>'),La=A('<div class="capture-hint svelte-9e286u"><!> <button class="btn-cancel svelte-9e286u" aria-label="Cancel">‚úï</button></div>'),Ha=A('<div class="board svelte-9e286u"><div class="zone opponent-zone svelte-9e286u"><div class="player-bar svelte-9e286u"><span class="player-name svelte-9e286u">Opponent</span> <div class="stats svelte-9e286u"><span class="svelte-9e286u"> </span> <span class="svelte-9e286u"> </span> <span class="pts svelte-9e286u"> </span></div> <!></div> <div class="hand-row svelte-9e286u"><!></div></div> <div class="zone table-zone svelte-9e286u"><div class="zone-header svelte-9e286u"><span class="zone-label svelte-9e286u">Table</span> <span class="deck-pill svelte-9e286u"> </span></div> <div class="card-row table-cards svelte-9e286u"><!> <!></div></div> <!> <!> <!> <div class="zone player-zone svelte-9e286u"><div class="player-bar svelte-9e286u"><span class="player-name svelte-9e286u">You</span> <div class="stats svelte-9e286u"><span class="svelte-9e286u"> </span> <span class="svelte-9e286u"> </span> <span class="pts svelte-9e286u"> </span></div> <!></div> <div class="card-row hand-row svelte-9e286u"></div> <!></div></div>');function Wa(e,t){Ae(t,!1);const r=()=>H(ne,"$captureOptions",_),s=()=>H(ue,"$selectedCard",_),c=()=>H(Gs,"$isMyTurn",_),a=()=>H(Vs,"$scores",_),o=()=>H(it,"$playerId",_),d=()=>H(qt,"$opponentId",_),l=()=>H(Ce,"$gameState",_),u=()=>H(Qs,"$tableCards",_),f=()=>H(st,"$lastScopaBy",_),m=()=>H(xe,"$errorMessage",_),p=()=>H(Fe,"$roundResult",_),S=()=>H(Ks,"$myHand",_),x=()=>H(re,"$capturesLoaded",_),[_,n]=jt(),v=P(),z=P(),L=P(),N=P(),F=P(),I=P(),y=P(),k=P();let O=P(new Set);function C(h){var M;if(c()){if(((M=s())==null?void 0:M.id)===h.id){r().length===0?B(h.id,[]):Z();return}ue.set(h),ne.set([]),re.set(!1),D(O,new Set),Ta(h.id)}}function W(h){if(!s()||!c()||!i(v).has(h.id)&&!i(O).has(h.id))return;const M=new Set(i(O));M.has(h.id)?M.delete(h.id):M.add(h.id),D(O,M);const _e=[...i(O)],ge=r().find(be=>be.length===_e.length&&_e.every(he=>be.includes(he)));ge&&B(s().id,ge)}function B(h,M){xa(h,M),ue.set(null),ne.set([]),re.set(!1),D(O,new Set)}function Z(){ue.set(null),ne.set([]),re.set(!1),D(O,new Set)}const le={bastoni:"ü™µ",coppe:"üèÜ",oro:"ü™ô",spade:"‚öîÔ∏è"};j(()=>r(),()=>{D(v,new Set(r().flat()))}),j(()=>s(),()=>{s()===null&&D(O,new Set)}),j(()=>(a(),o()),()=>{D(z,a()[o()]??0)}),j(()=>(a(),d()),()=>{D(L,a()[d()]??0)}),j(()=>(l(),o()),()=>{var h,M;D(N,((M=(h=l())==null?void 0:h.players)==null?void 0:M[o()])??{})}),j(()=>(l(),d()),()=>{var h,M;D(F,((M=(h=l())==null?void 0:h.players)==null?void 0:M[d()])??{})}),j(()=>l(),()=>{var h;D(I,((h=l())==null?void 0:h.phase)??"playing")}),j(()=>l(),()=>{var h;D(y,((h=l())==null?void 0:h.deck_remaining)??0)}),j(()=>c(),()=>{D(k,c())}),He(),We();var ee=dt(),q=ke(ee);{var ce=h=>{var M=Ca();E(h,M)},pe=h=>{var M=Ha(),_e=b(M),ge=b(_e),be=$(b(ge),2),he=b(be),Jt=b(he);g(he);var Be=$(he,2),Xt=b(Be);g(Be);var ft=$(Be,2),Zt=b(ft);g(ft),g(be);var es=$(be,2);{var ts=w=>{var T=Ea();E(w,T)};Y(es,w=>{l()&&!i(k)&&w(ts)})}g(ge);var pt=$(ge,2),ss=b(pt);{let w=Se(()=>(i(F),R(()=>i(F).hand_count??0)));wa(ss,{get count(){return i(w)}})}g(pt),g(_e);var Ue=$(_e,2),Pe=b(Ue),_t=$(b(Pe),2),as=b(_t);g(_t),g(Pe);var gt=$(Pe,2),bt=b(gt);Ie(bt,1,u,w=>w.id,(w,T)=>{{let G=Se(()=>(s(),i(k),i(v),i(T),i(O),R(()=>!!s()&&i(k)&&i(v).has(i(T).id)&&!i(O).has(i(T).id)))),J=Se(()=>(s(),i(k),i(O),i(T),R(()=>!!s()&&i(k)&&i(O).has(i(T).id))));zt(w,{get card(){return i(T)},get capturable(){return i(G)},get pending(){return i(J)},animateIn:!0,$$events:{click:()=>W(i(T))}})}});var ns=$(bt,2);{var rs=w=>{var T=Ia();E(w,T)};Y(ns,w=>{u(),R(()=>u().length===0)&&w(rs)})}g(gt),g(Ue);var ht=$(Ue,2);{var is=w=>{var T=Na();let G;var J=b(T);g(T),K(()=>{G=Ne(T,1,"scopa-toast svelte-9e286u",null,G,{"scopa-mine":f().is_mine}),U(J,`üßπ ${f(),R(()=>f().is_mine?"¬°Scopa!":"Scopa del oponente!")??""}`)}),E(w,T)};Y(ht,w=>{f()&&w(is)})}var yt=$(ht,2);{var os=w=>{var T=Aa(),G=b(T);g(T),K(()=>U(G,`‚ö†Ô∏è ${m()??""}`)),E(w,T)};Y(yt,w=>{m()&&w(os)})}var mt=$(yt,2);{var ls=w=>{var T=Oa(),G=b(T),J=$(b(G),2),Qe=b(J);g(J);var ye=$(J,2),me=b(ye),Me=$(b(me),2),V=b(Me);g(Me),g(me);var X=$(me,2),Re=$(b(X),2),gs=b(Re);g(Re),g(X),g(ye);var St=$(ye,2),Ke=$(b(St)),bs=b(Ke,!0);g(Ke);var xt=$(Ke,2),hs=b(xt,!0);g(xt),g(St),Yt(2),g(G),g(T),K(()=>{U(Qe,`Round ${p(),R(()=>p().round_number)??""} complete`),U(V,`+${p(),o(),R(()=>{var te;return((te=p().round_scores)==null?void 0:te[o()])??0})??""} pts`),U(gs,`+${p(),d(),R(()=>{var te;return((te=p().round_scores)==null?void 0:te[d()])??0})??""} pts`),U(bs,(p(),o(),R(()=>{var te;return((te=p().cumulative)==null?void 0:te[o()])??0}))),U(hs,(p(),d(),R(()=>{var te;return((te=p().cumulative)==null?void 0:te[d()])??0})))}),E(w,T)};Y(mt,w=>{p()&&w(ls)})}var wt=$(mt,2),Ye=b(wt),qe=$(b(Ye),2),je=b(qe),cs=b(je);g(je);var Ge=$(je,2),vs=b(Ge);g(Ge);var $t=$(Ge,2),ds=b($t);g($t),g(qe);var us=$(qe,2);{var fs=w=>{var T=Ma();E(w,T)};Y(us,w=>{i(k)&&w(fs)})}g(Ye);var Ve=$(Ye,2);Ie(Ve,5,S,w=>w.id,(w,T)=>{{let G=Se(()=>(s(),i(T),R(()=>{var J;return((J=s())==null?void 0:J.id)===i(T).id})));zt(w,{get card(){return i(T)},get selectable(){return i(k)},get selected(){return i(G)},animateIn:!0,$$events:{click:()=>C(i(T))}})}}),g(Ve);var ps=$(Ve,2);{var _s=w=>{var T=La(),G=b(T);{var J=V=>{var X=Ra();E(V,X)},Qe=V=>{var X=za();E(V,X)},ye=V=>{var X=Da();E(V,X)},me=V=>{var X=Fa(),Re=b(X);g(X),K(()=>U(Re,`${s(),R(()=>le[s().suit]??"")??""} ${s(),R(()=>s().value)??""} selected ‚Äî tap again to discard if no captures`)),E(V,X)};Y(G,V=>{r(),i(O),R(()=>r().length>0&&i(O).size>0)?V(J):(r(),R(()=>r().length>0)?V(Qe,1):x()?V(ye,2):V(me,!1))})}var Me=$(G,2);g(T),Ee("click",Me,Z),E(w,T)};Y(ps,w=>{s()&&i(k)&&w(_s)})}g(wt),g(M),K(()=>{U(Jt,`üì¶ ${i(F),R(()=>i(F).captured_count??0)??""}`),U(Xt,`üßπ ${i(F),R(()=>i(F).scopas??0)??""}`),U(Zt,`${i(L)??""} pts`),U(as,`üÇ† ${i(y)??""} in deck`),U(cs,`üì¶ ${i(N),R(()=>i(N).captured_count??0)??""}`),U(vs,`üßπ ${i(N),R(()=>i(N).scopas??0)??""}`),U(ds,`${i(z)??""} pts`)}),E(h,M)};Y(q,h=>{l()?h(pe,!1):h(ce)})}E(e,ee),Oe(),n()}var Ba=A('<div class="zone-hint mid svelte-atckps">Table</div>'),Ua=A('<div class="deck-card svelte-atckps"></div>'),Pa=A("<div></div>"),Ya=A('<div class="overlay svelte-atckps"><div class="round-label svelte-atckps"> </div> <div class="zone-hint top svelte-atckps">Opponent</div> <!> <div class="zone-hint bot svelte-atckps">You</div> <div></div> <!></div>');function qa(e,t){Ae(t,!1);let r=ae(t,"round",8,1),s=ae(t,"type",8,"full");const c=Dt(),a=[{dest:"table",idx:0},{dest:"table",idx:1},{dest:"table",idx:2},{dest:"table",idx:3},{dest:"player",idx:0},{dest:"opponent",idx:0},{dest:"player",idx:1},{dest:"opponent",idx:1},{dest:"player",idx:2},{dest:"opponent",idx:2}],o=[{dest:"player",idx:0},{dest:"opponent",idx:0},{dest:"player",idx:1},{dest:"opponent",idx:1},{dest:"player",idx:2},{dest:"opponent",idx:2}],d=s()==="hands"?o:a,l=130,u=500,f=600;function m(I,y){switch(I){case"table":return{tx:`${(y-1.5)*80}px`,ty:"0px"};case"opponent":return{tx:`${(y-1)*72}px`,ty:"-42vh"};case"player":return{tx:`${(y-1)*72}px`,ty:"42vh"}}}let p=P(d.map((I,y)=>({...I,...m(I.dest,I.idx),flying:!1,landed:!1,delay:y*l}))),S=P(!1);Ft(()=>{setTimeout(()=>{D(S,!0),i(p).forEach((y,k)=>{setTimeout(()=>{Et(p,i(p)[k].flying=!0),D(p,i(p)),setTimeout(()=>{Et(p,i(p)[k].landed=!0),D(p,i(p))},u)},y.delay)});const I=d.length*l+u+f;setTimeout(()=>c("done"),I)},350)}),We();var x=Ya(),_=b(x),n=b(_);g(_);var v=$(_,4);{var z=I=>{var y=Ba();E(I,y)};Y(v,I=>{s()==="full"&&I(z)})}var L=$(v,4);let N;Ie(L,4,()=>[4,3,2,1,0],ot,(I,y)=>{var k=Ua();K(()=>vt(k,`transform: translate(${y*1.5}px, ${-y*1.5}px)`)),E(I,k)}),g(L);var F=$(L,2);Ie(F,1,()=>i(p),ot,(I,y)=>{var k=Pa();let O;K(()=>{O=Ne(k,1,"flying-card svelte-atckps",null,O,{fly:i(y).flying,landed:i(y).landed}),vt(k,`--tx:${i(y),R(()=>i(y).tx)??""}; --ty:${i(y),R(()=>i(y).ty)??""}; --dur:500ms;`)}),E(I,k)}),g(x),K(()=>{U(n,`Round ${r()??""}`),N=Ne(L,1,"deck svelte-atckps",null,N,{glow:i(S)})}),E(e,x),Oe()}var ja=A('<div class="overlay svelte-7np8yw"><div class="spinner svelte-7np8yw"></div> <p>Connecting‚Ä¶</p></div>'),Ga=A('<p class="hint svelte-7np8yw">Share this code with your friend:</p> <div class="join-code svelte-7np8yw"> </div> <button class="btn-copy svelte-7np8yw"> </button>',1),Va=A('<div class="overlay svelte-7np8yw"><div class="lobby svelte-7np8yw"><div class="lobby-icon svelte-7np8yw">üÉè</div> <h2 class="svelte-7np8yw">Waiting for opponent</h2> <!> <p class="sub-hint svelte-7np8yw">The game starts automatically when they connect.</p> <div class="spinner-sm svelte-7np8yw"></div></div></div>'),Qa=A('<div class="overlay svelte-7np8yw"><div class="lobby svelte-7np8yw"><div class="lobby-icon svelte-7np8yw">‚ö°</div> <h2 class="svelte-7np8yw">Disconnected</h2> <p class="hint svelte-7np8yw">The connection was lost.</p> <button class="btn-home svelte-7np8yw">‚Üê Home</button></div></div>'),Ka=A("<!> <!>",1);function cn(e,t){Ae(t,!1);const r=()=>H(fa,"$page",m),s=()=>H(It,"$joinCode",m),c=()=>H(it,"$playerId",m),a=()=>H(de,"$wsStatus",m),o=()=>H(rt,"$isWaiting",m),d=()=>H(Ce,"$gameState",m),l=()=>H(Le,"$isDealing",m),u=()=>H(at,"$roundNumber",m),f=()=>H(nt,"$dealType",m),[m,p]=jt(),S=P(),x=P(),_=P(),n=P(),v=r().params.session_id;let z=P(!1);async function L(){s()&&(await navigator.clipboard.writeText(s()),D(z,!0),setTimeout(()=>D(z,!1),2e3))}Ft(()=>{let C=c();if(!C){C=sessionStorage.getItem("scopa_player_id");const W=sessionStorage.getItem("scopa_session_id"),B=sessionStorage.getItem("scopa_join_code");if(!C||W!==v){Nt("/");return}Xs.set(v),it.set(C),B&&It.set(B)}$a(v,C)}),ys(()=>{Sa()}),j(()=>a(),()=>{D(S,a()==="connecting")}),j(()=>(a(),o()),()=>{D(x,a()==="waiting"||o())}),j(()=>(a(),d()),()=>{D(_,a()==="connected"&&d()!==null)}),j(()=>a(),()=>{D(n,a()==="disconnected")}),He(),We();var N=dt();Js("7np8yw",C=>{Ut(()=>{qs.title="Scopa ¬∑ Game"})});var F=ke(N);{var I=C=>{var W=ja();E(C,W)},y=C=>{var W=Va(),B=b(W),Z=$(b(B),4);{var le=ee=>{var q=Ga(),ce=$(ke(q),2),pe=b(ce,!0);g(ce);var h=$(ce,2),M=b(h,!0);g(h),K(()=>{U(pe,s()),U(M,i(z)?"‚úÖ Copied!":"üìã Copy Code")}),Ee("click",h,L),E(ee,q)};Y(Z,ee=>{s()&&ee(le)})}Yt(4),g(B),g(W),E(C,W)},k=C=>{var W=Qa(),B=b(W),Z=$(b(B),6);g(B),g(W),Ee("click",Z,()=>Nt("/")),E(C,W)},O=C=>{var W=Ka(),B=ke(W);{var Z=q=>{qa(q,{get round(){return u()},get type(){return f()},$$events:{done:()=>Le.set(!1)}})};Y(B,q=>{l()&&q(Z)})}var le=$(B,2);{var ee=q=>{Wa(q,{})};Y(le,q=>{(!l()||d())&&q(ee)})}E(C,W)};Y(F,C=>{i(S)?C(I):i(x)?C(y,1):i(n)&&!d()?C(k,2):C(O,!1)})}E(e,N),Oe(),p()}export{cn as component,ln as universal};
