import{a as j,f as S}from"../chunks/Bwf9qTKs.js";import"../chunks/BbsrXejN.js";import{a2 as W,A as I,a3 as Z,H as q,b as z,a4 as D,a5 as F,X as K,_ as L,a6 as Q,a7 as R,a1 as d,$ as m,g as r,a0 as _,m as G,Z as x,a8 as Y,s as o}from"../chunks/DtFH08mZ.js";import{e as h,s as X}from"../chunks/BSBlUjVE.js";import{i as T}from"../chunks/CSHLn78M.js";import{h as ee,r as ae,s as B,p as M,j as P}from"../chunks/DSjyWIzM.js";import{i as se}from"../chunks/C1tfcwLj.js";import{g as U}from"../chunks/C54pvyWc.js";function te(e,u,v=u){var l=new WeakSet;W(e,"input",async i=>{var s=i?e.defaultValue:e.value;if(s=O(e)?A(s):s,v(s),I!==null&&l.add(I),await Z(),s!==(s=u())){var E=e.selectionStart,f=e.selectionEnd,p=e.value.length;if(e.value=s??"",f!==null){var y=e.value.length;E===f&&f===p&&y>p?(e.selectionStart=y,e.selectionEnd=y):(e.selectionStart=E,e.selectionEnd=Math.min(f,y))}}}),(q&&e.defaultValue!==e.value||z(u)==null&&e.value)&&(v(O(e)?A(e.value):e.value),I!==null&&l.add(I)),D(()=>{var i=u();if(e===document.activeElement){var s=F??I;if(l.has(s))return}O(e)&&i===A(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function O(e){var u=e.type;return u==="number"||u==="range"}function A(e){return e===""?null:+e}var oe=S('<div class="menu svelte-1uha8ag"><button class="btn-primary svelte-1uha8ag">Create Game</button> <button class="btn-secondary svelte-1uha8ag">Join Game</button></div>'),re=S('<div class="error svelte-1uha8ag"> </div>'),ie=S('<div class="panel svelte-1uha8ag"><h2 class="svelte-1uha8ag">Create Game</h2> <p class="svelte-1uha8ag">A 6-letter code will be generated.<br/>Share it with a friend to start playing.</p> <!> <button class="btn-primary svelte-1uha8ag"> </button> <button class="btn-back svelte-1uha8ag">â† Back</button></div>'),ne=S('<div class="error svelte-1uha8ag"> </div>'),le=S('<div class="panel svelte-1uha8ag"><h2 class="svelte-1uha8ag">Join Game</h2> <p class="svelte-1uha8ag">Enter the code your friend shared with you.</p> <input class="code-input svelte-1uha8ag" placeholder="XXXXXX" maxlength="6"/> <!> <button class="btn-primary svelte-1uha8ag"> </button> <button class="btn-back svelte-1uha8ag">â† Back</button></div>'),ce=S('<main class="home svelte-1uha8ag"><div class="hero svelte-1uha8ag"><div class="logo svelte-1uha8ag">ğŸƒ</div> <h1 class="svelte-1uha8ag">Scopa</h1> <p class="subtitle svelte-1uha8ag">The classic Italian card game â€” now multiplayer</p></div> <!></main>');function be(e,u){K(u,!1);let v=G("menu"),l=G(""),i=G(!1),s=G("");async function E(){o(i,!0),o(s,"");try{const t=await fetch("/api/session",{method:"POST"});if(!t.ok)throw new Error("Could not create session â€” is the server running?");const a=await t.json();B.set(a.session_id),M.set(a.player_id),P.set(a.join_code),sessionStorage.setItem("scopa_session_id",a.session_id),sessionStorage.setItem("scopa_player_id",a.player_id),sessionStorage.setItem("scopa_join_code",a.join_code),U(`/game/${a.session_id}`)}catch(t){o(s,t.message)}finally{o(i,!1)}}async function f(){if(r(l).trim()){o(i,!0),o(s,"");try{const t=await fetch("/api/session/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({join_code:r(l).trim().toUpperCase()})}),a=await t.json();if(!t.ok)throw new Error(a.detail||"Could not join session.");B.set(a.session_id),M.set(a.player_id),P.set(null),sessionStorage.setItem("scopa_session_id",a.session_id),sessionStorage.setItem("scopa_player_id",a.player_id),sessionStorage.removeItem("scopa_join_code"),U(`/game/${a.session_id}`)}catch(t){o(s,t.message)}finally{o(i,!1)}}}se();var p=ce();ee("1uha8ag",t=>{Q(()=>{R.title="Scopa"})});var y=d(m(p),2);{var V=t=>{var a=oe(),c=m(a),k=d(c,2);_(a),h("click",c,()=>o(v,"create")),h("click",k,()=>o(v,"join")),j(t,a)},$=t=>{var a=ie(),c=d(m(a),4);{var k=w=>{var n=re(),C=m(n,!0);_(n),x(()=>X(C,r(s))),j(w,n)};T(c,w=>{r(s)&&w(k)})}var g=d(c,2),b=m(g,!0);_(g);var J=d(g,2);_(a),x(()=>{g.disabled=r(i),X(b,r(i)?"Creatingâ€¦":"âœ…  Create Game")}),h("click",g,E),h("click",J,()=>{o(v,"menu"),o(s,"")}),j(t,a)},H=t=>{var a=le(),c=d(m(a),4);ae(c),Y(c);var k=d(c,2);{var g=n=>{var C=ne(),N=m(C,!0);_(C),x(()=>X(N,r(s))),j(n,C)};T(k,n=>{r(s)&&n(g)})}var b=d(k,2),J=m(b,!0);_(b);var w=d(b,2);_(a),x(n=>{b.disabled=n,X(J,r(i)?"Joiningâ€¦":"ğŸ®  Join Game")},[()=>r(i)||!r(l).trim()]),te(c,()=>r(l),n=>o(l,n)),h("input",c,()=>o(l,r(l).toUpperCase())),h("keydown",c,n=>n.key==="Enter"&&f()),h("click",b,f),h("click",w,()=>{o(v,"menu"),o(s,""),o(l,"")}),j(t,a)};T(y,t=>{r(v)==="menu"?t(V):r(v)==="create"?t($,1):r(v)==="join"&&t(H,2)})}_(p),j(e,p),L()}export{be as component};
